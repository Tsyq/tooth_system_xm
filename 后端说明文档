# ç‰™ç§‘é¢„çº¦ç®¡ç†ç³»ç»Ÿ - åç«¯æ­å»ºè¯´æ˜æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆ](#2-æŠ€æœ¯æ ˆ)
3. [ç¯å¢ƒå‡†å¤‡](#3-ç¯å¢ƒå‡†å¤‡)
4. [é¡¹ç›®ç»“æ„](#4-é¡¹ç›®ç»“æ„)
5. [æ•°æ®åº“è®¾è®¡](#5-æ•°æ®åº“è®¾è®¡)
6. [Djangoé¡¹ç›®åˆå§‹åŒ–](#6-djangoé¡¹ç›®åˆå§‹åŒ–)
7. [DRFé…ç½®](#7-drfé…ç½®)
8. [JWTè®¤è¯é…ç½®](#8-jwtè®¤è¯é…ç½®)
9. [æ¨¡å‹è®¾è®¡](#9-æ¨¡å‹è®¾è®¡)
10. [è§†å›¾å’Œåºåˆ—åŒ–å™¨](#10-è§†å›¾å’Œåºåˆ—åŒ–å™¨)
11. [URLè·¯ç”±é…ç½®](#11-urlè·¯ç”±é…ç½®)
12. [ä¸­é—´ä»¶å’Œæƒé™](#12-ä¸­é—´ä»¶å’Œæƒé™)
13. [æ–‡ä»¶ä¸Šä¼ é…ç½®](#13-æ–‡ä»¶ä¸Šä¼ é…ç½®)
14. [Nginxé…ç½®](#14-nginxé…ç½®)
15. [å¼€å‘è§„èŒƒ](#15-å¼€å‘è§„èŒƒ)
16. [éƒ¨ç½²è¯´æ˜](#16-éƒ¨ç½²è¯´æ˜)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹

ç‰™ç§‘é¢„çº¦ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªå‰åç«¯åˆ†ç¦»çš„Webåº”ç”¨ï¼Œåç«¯åŸºäºDjango REST Frameworkæ„å»ºRESTful APIï¼Œä¸ºå‰ç«¯æä¾›æ•°æ®æ¥å£å’Œä¸šåŠ¡é€»è¾‘æ”¯æŒã€‚

### 1.2 æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

- **ç”¨æˆ·è®¤è¯æ¨¡å—**: æ³¨å†Œã€ç™»å½•ã€JWT Tokenç®¡ç†
- **åŒ»é™¢ç®¡ç†æ¨¡å—**: åŒ»é™¢ä¿¡æ¯CRUDã€æœç´¢ã€ç­›é€‰
- **åŒ»ç”Ÿç®¡ç†æ¨¡å—**: åŒ»ç”Ÿä¿¡æ¯ç®¡ç†ã€åœ¨çº¿çŠ¶æ€ã€æ’è¡Œæ¦œ
- **é¢„çº¦ç®¡ç†æ¨¡å—**: é¢„çº¦åˆ›å»ºã€æŸ¥è¯¢ã€å–æ¶ˆã€ç­¾åˆ°ã€å®Œæˆ
- **ç—…å†ç®¡ç†æ¨¡å—**: ç—…å†åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ï¼ˆåŒ»ç”Ÿæƒé™ï¼‰
- **åœ¨çº¿é—®è¯Šæ¨¡å—**: å®æ—¶èŠå¤©ã€æ¶ˆæ¯ç®¡ç†
- **AIé—®è¯¢æ¨¡å—**: AIæ™ºèƒ½é—®ç­”
- **æ–‡ä»¶ä¸Šä¼ æ¨¡å—**: å›¾ç‰‡ä¸Šä¼ ã€æ–‡ä»¶ç®¡ç†
- **ç»Ÿè®¡æ•°æ®æ¨¡å—**: é¦–é¡µç»Ÿè®¡æ•°æ®

### 1.3 APIåŸºç¡€ä¿¡æ¯

- **APIåŸºç¡€è·¯å¾„**: `/api/`
- **æ•°æ®æ ¼å¼**: JSON
- **å­—ç¬¦ç¼–ç **: UTF-8
- **è®¤è¯æ–¹å¼**: JWT Token (Bearer Token)
- **å¼€å‘ç¯å¢ƒåœ°å€**: `http://localhost:8000/api`

---

## 2. æŠ€æœ¯æ ˆ

### 2.1 æ ¸å¿ƒæŠ€æœ¯

- **Webæ¡†æ¶**: Django 4.2+
- **APIæ¡†æ¶**: Django REST Framework (DRF) 3.14+
- **æ•°æ®åº“**: MySQL 8.0+
- **WebæœåŠ¡å™¨**: Nginx
- **è®¤è¯**: JWT (djangorestframework-simplejwt)
- **Pythonç‰ˆæœ¬**: Python 3.10+

### 2.2 ä¾èµ–åŒ…æ¸…å•

```txt
Django==4.2.7
djangorestframework==3.14.0
djangorestframework-simplejwt==5.3.0
mysqlclient==2.2.0
Pillow==10.1.0
python-decouple==3.8
django-cors-headers==4.3.1
django-filter==23.5
```

---

## 3. ç¯å¢ƒå‡†å¤‡

### 3.1 Pythonç¯å¢ƒ

```bash
# æ¨èä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# Windowsæ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
venv\Scripts\activate

# Linux/Macæ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate
```

### 3.2 MySQLæ•°æ®åº“å‡†å¤‡

```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE tooth_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºæ•°æ®åº“ç”¨æˆ·ï¼ˆå¯é€‰ï¼‰
CREATE USER 'tooth_user'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON tooth_system.* TO 'tooth_user'@'localhost';
FLUSH PRIVILEGES;
```

### 3.3 å®‰è£…ä¾èµ–

```bash
# å®‰è£…Pythonä¾èµ–
pip install -r requirements.txt

# å¦‚æœmysqlclientå®‰è£…å¤±è´¥ï¼ŒWindowsç”¨æˆ·éœ€è¦å…ˆå®‰è£…MySQL Connector/C
# ä¸‹è½½åœ°å€: https://dev.mysql.com/downloads/connector/c/
```

---

## 4. é¡¹ç›®ç»“æ„

### 4.1 æ¨èç›®å½•ç»“æ„

```
tooth_system_backend/
â”œâ”€â”€ manage.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .env                    # ç¯å¢ƒå˜é‡é…ç½®ï¼ˆä¸æäº¤åˆ°Gitï¼‰
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md
â”œâ”€â”€ config/                 # é¡¹ç›®é…ç½®ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py         # Djangoè®¾ç½®
â”‚   â”œâ”€â”€ urls.py             # ä¸»URLé…ç½®
â”‚   â”œâ”€â”€ wsgi.py
â”‚   â””â”€â”€ asgi.py
â”œâ”€â”€ apps/                   # åº”ç”¨ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ users/              # ç”¨æˆ·è®¤è¯åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â”œâ”€â”€ serializers.py
â”‚   â”‚   â”œâ”€â”€ views.py
â”‚   â”‚   â”œâ”€â”€ urls.py
â”‚   â”‚   â””â”€â”€ permissions.py
â”‚   â”œâ”€â”€ hospitals/          # åŒ»é™¢ç®¡ç†åº”ç”¨
â”‚   â”œâ”€â”€ doctors/            # åŒ»ç”Ÿç®¡ç†åº”ç”¨
â”‚   â”œâ”€â”€ appointments/       # é¢„çº¦ç®¡ç†åº”ç”¨
â”‚   â”œâ”€â”€ records/            # ç—…å†ç®¡ç†åº”ç”¨
â”‚   â”œâ”€â”€ consultations/      # åœ¨çº¿é—®è¯Šåº”ç”¨
â”‚   â”œâ”€â”€ ai_inquiry/         # AIé—®è¯¢åº”ç”¨
â”‚   â”œâ”€â”€ uploads/            # æ–‡ä»¶ä¸Šä¼ åº”ç”¨
â”‚   â””â”€â”€ statistics/         # ç»Ÿè®¡æ•°æ®åº”ç”¨
â”œâ”€â”€ utils/                  # å·¥å…·ç±»
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ response.py         # ç»Ÿä¸€å“åº”æ ¼å¼
â”‚   â”œâ”€â”€ permissions.py      # è‡ªå®šä¹‰æƒé™
â”‚   â””â”€â”€ captcha.py          # éªŒè¯ç ç”Ÿæˆ
â”œâ”€â”€ media/                  # åª’ä½“æ–‡ä»¶ï¼ˆç”¨æˆ·ä¸Šä¼ ï¼‰
â”‚   â”œâ”€â”€ avatars/
â”‚   â”œâ”€â”€ records/
â”‚   â””â”€â”€ hospitals/
â””â”€â”€ static/                 # é™æ€æ–‡ä»¶
```

### 4.2 åˆ›å»ºé¡¹ç›®ç»“æ„

```bash
# åˆ›å»ºDjangoé¡¹ç›®
django-admin startproject config .

# åˆ›å»ºåº”ç”¨ç›®å½•
mkdir apps
cd apps

# åˆ›å»ºå„ä¸ªåº”ç”¨
python ../manage.py startapp users
python ../manage.py startapp hospitals
python ../manage.py startapp doctors
python ../manage.py startapp appointments
python ../manage.py startapp records
python ../manage.py startapp consultations
python ../manage.py startapp ai_inquiry
python ../manage.py startapp uploads
python ../manage.py startapp statistics

# åˆ›å»ºå·¥å…·ç›®å½•
cd ..
mkdir utils
```

---

## 5. æ•°æ®åº“è®¾è®¡

### 5.1 æ ¸å¿ƒæ•°æ®è¡¨

#### 5.1.1 ç”¨æˆ·è¡¨ (users_user)

```python
å­—æ®µè¯´æ˜:
- id: ä¸»é”®ï¼Œè‡ªå¢
- phone: æ‰‹æœºå·ï¼Œå”¯ä¸€ï¼Œ11ä½æ•°å­—
- password: å¯†ç ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
- name: å§“å
- role: è§’è‰² (user/doctor/admin)
- avatar: å¤´åƒURLï¼ˆå¯é€‰ï¼‰
- status: çŠ¶æ€ (active/pending/inactive)
- created_at: åˆ›å»ºæ—¶é—´
- updated_at: æ›´æ–°æ—¶é—´
```

#### 5.1.2 åŒ»é™¢è¡¨ (hospitals_hospital)

```python
å­—æ®µè¯´æ˜:
- id: ä¸»é”®ï¼Œè‡ªå¢
- name: åŒ»é™¢åç§°
- address: åœ°å€
- phone: è”ç³»ç”µè¯
- latitude: çº¬åº¦
- longitude: ç»åº¦
- image: å›¾ç‰‡URL
- rating: è¯„åˆ†ï¼ˆ0-5ï¼‰
- review_count: è¯„ä»·æ•°é‡
- description: ç®€ä»‹
- business_hours: è¥ä¸šæ—¶é—´
- created_at: åˆ›å»ºæ—¶é—´
- updated_at: æ›´æ–°æ—¶é—´
```

#### 5.1.3 åŒ»ç”Ÿè¡¨ (doctors_doctor)

```python
å­—æ®µè¯´æ˜:
- id: ä¸»é”®ï¼Œè‡ªå¢ï¼ˆä¸šåŠ¡ä¸»é”®ï¼‰
- user_id: å¤–é”®å…³è”users_user
- name: å§“å
- title: èŒç§°
- specialty: ä¸“ç§‘
- hospital_id: å¤–é”®å…³è”hospitals_hospital
- avatar: å¤´åƒURL
- score: è¯„åˆ†ï¼ˆ0-5ï¼‰
- reviews: è¯„ä»·æ•°é‡
- introduction: ç®€ä»‹
- education: å­¦å†
- experience: ç»éªŒ
- is_online: æ˜¯å¦åœ¨çº¿
- is_admin: æ˜¯å¦ä¸ºç®¡ç†å‘˜
- created_at: åˆ›å»ºæ—¶é—´
- updated_at: æ›´æ–°æ—¶é—´
```

#### 5.1.4 é¢„çº¦è¡¨ (appointments_appointment)

```python
å­—æ®µè¯´æ˜:
- id: ä¸»é”®ï¼Œè‡ªå¢
- user_id: å¤–é”®å…³è”users_userï¼ˆæ‚£è€…ï¼‰
- doctor_id: å¤–é”®å…³è”doctors_doctor
- hospital_id: å¤–é”®å…³è”hospitals_hospital
- appointment_date: é¢„çº¦æ—¥æœŸ
- appointment_time: é¢„çº¦æ—¶é—´ï¼ˆHH:mmï¼‰
- symptoms: ç—‡çŠ¶æè¿°
- status: çŠ¶æ€ (pending/confirmed/cancelled/completed/no_show)
- check_in_time: ç­¾åˆ°æ—¶é—´
- created_at: åˆ›å»ºæ—¶é—´
- updated_at: æ›´æ–°æ—¶é—´
```

#### 5.1.5 ç—…å†è¡¨ (records_record)

```python
å­—æ®µè¯´æ˜:
- id: ä¸»é”®ï¼Œè‡ªå¢
- user_id: å¤–é”®å…³è”users_userï¼ˆæ‚£è€…ï¼‰
- doctor_id: å¤–é”®å…³è”doctors_doctor
- appointment_id: å¤–é”®å…³è”appointments_appointmentï¼ˆå¯é€‰ï¼‰
- diagnosis: è¯Šæ–­
- treatment: æ²»ç–—æ–¹æ¡ˆ
- prescription: å¤„æ–¹
- images: JSONå­—æ®µï¼Œå­˜å‚¨å›¾ç‰‡URLæ•°ç»„
- notes: å¤‡æ³¨
- created_at: åˆ›å»ºæ—¶é—´
- updated_at: æ›´æ–°æ—¶é—´
```

#### 5.1.6 é—®è¯Šæ¶ˆæ¯è¡¨ (consultations_message)

```python
å­—æ®µè¯´æ˜:
- id: ä¸»é”®ï¼Œè‡ªå¢
- consultation_id: é—®è¯Šä¼šè¯IDï¼ˆå­—ç¬¦ä¸²ï¼‰
- sender_id: å‘é€è€…IDï¼ˆç”¨æˆ·æˆ–åŒ»ç”Ÿï¼‰
- sender_type: å‘é€è€…ç±»å‹ (user/doctor)
- receiver_id: æ¥æ”¶è€…ID
- receiver_type: æ¥æ”¶è€…ç±»å‹
- content: æ¶ˆæ¯å†…å®¹
- message_type: æ¶ˆæ¯ç±»å‹ (text/image)
- created_at: åˆ›å»ºæ—¶é—´
```

#### 5.1.7 AIé—®è¯¢è®°å½•è¡¨ (ai_inquiry_inquiry)

```python
å­—æ®µè¯´æ˜:
- id: ä¸»é”®ï¼Œè‡ªå¢
- user_id: å¤–é”®å…³è”users_user
- question: é—®é¢˜
- answer: å›ç­”
- suggestions: JSONå­—æ®µï¼Œå»ºè®®åˆ—è¡¨
- created_at: åˆ›å»ºæ—¶é—´
```

### 5.2 æ•°æ®åº“å…³ç³»å›¾

```
users_user (1) â”€â”€â”
                 â”œâ”€â”€ (1) doctors_doctor
                 â”‚
                 â””â”€â”€ (N) appointments_appointment
                     â”‚
                     â””â”€â”€ (0..1) records_record

hospitals_hospital (1) â”€â”€ (N) doctors_doctor
doctors_doctor (1) â”€â”€ (N) appointments_appointment
doctors_doctor (1) â”€â”€ (N) records_record
```

---

## 6. Djangoé¡¹ç›®åˆå§‹åŒ–

### 6.1 settings.py åŸºç¡€é…ç½®

```python
# config/settings.py

import os
from pathlib import Path
from decouple import config

BASE_DIR = Path(__file__).resolve().parent.parent

# å®‰å…¨é…ç½®
SECRET_KEY = config('SECRET_KEY', default='django-insecure-change-me-in-production')
DEBUG = config('DEBUG', default=True, cast=bool)
ALLOWED_HOSTS = config('ALLOWED_HOSTS', default='localhost,127.0.0.1', cast=lambda v: [s.strip() for s in v.split(',')])

# åº”ç”¨é…ç½®
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    
    # ç¬¬ä¸‰æ–¹åº”ç”¨
    'rest_framework',
    'rest_framework_simplejwt',
    'corsheaders',
    'django_filters',
    
    # æœ¬åœ°åº”ç”¨
    'apps.users',
    'apps.hospitals',
    'apps.doctors',
    'apps.appointments',
    'apps.records',
    'apps.consultations',
    'apps.ai_inquiry',
    'apps.uploads',
    'apps.statistics',
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'corsheaders.middleware.CorsMiddleware',  # CORSä¸­é—´ä»¶
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'config.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'config.wsgi.application'

# æ•°æ®åº“é…ç½®
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': config('DB_NAME', default='tooth_system'),
        'USER': config('DB_USER', default='root'),
        'PASSWORD': config('DB_PASSWORD', default=''),
        'HOST': config('DB_HOST', default='localhost'),
        'PORT': config('DB_PORT', default='3306'),
        'OPTIONS': {
            'charset': 'utf8mb4',
            'init_command': "SET sql_mode='STRICT_TRANS_TABLES'",
        },
    }
}

# å¯†ç éªŒè¯
AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]

# å›½é™…åŒ–
LANGUAGE_CODE = 'zh-hans'
TIME_ZONE = 'Asia/Shanghai'
USE_I18N = True
USE_TZ = True

# é™æ€æ–‡ä»¶
STATIC_URL = '/static/'
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')

# åª’ä½“æ–‡ä»¶
MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')

# é»˜è®¤ä¸»é”®ç±»å‹
DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

# è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹
AUTH_USER_MODEL = 'users.User'
```

### 6.2 .env æ–‡ä»¶é…ç½®

```bash
# .env æ–‡ä»¶ï¼ˆä¸æäº¤åˆ°Gitï¼‰

# Djangoé…ç½®
SECRET_KEY=your-secret-key-here
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1

# æ•°æ®åº“é…ç½®
DB_NAME=tooth_system
DB_USER=root
DB_PASSWORD=your_password
DB_HOST=localhost
DB_PORT=3306

# JWTé…ç½®
JWT_SECRET_KEY=your-jwt-secret-key
JWT_ALGORITHM=HS256
```

### 6.3 .gitignore é…ç½®

```gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
venv/
env/
ENV/

# Django
*.log
db.sqlite3
db.sqlite3-journal
/media
/staticfiles

# ç¯å¢ƒå˜é‡
.env
.env.local

# IDE
.vscode/
.idea/
*.swp
*.swo

# ç³»ç»Ÿæ–‡ä»¶
.DS_Store
Thumbs.db
```

---

## 7. DRFé…ç½®

### 7.1 REST Framework è®¾ç½®

```python
# config/settings.py

REST_FRAMEWORK = {
    # é»˜è®¤è®¤è¯ç±»
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'rest_framework_simplejwt.authentication.JWTAuthentication',
    ),
    
    # é»˜è®¤æƒé™ç±»
    'DEFAULT_PERMISSION_CLASSES': (
        'rest_framework.permissions.IsAuthenticated',
    ),
    
    # åˆ†é¡µè®¾ç½®
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 20,
    
    # è¿‡æ»¤å™¨
    'DEFAULT_FILTER_BACKENDS': (
        'django_filters.rest_framework.DjangoFilterBackend',
        'rest_framework.filters.SearchFilter',
        'rest_framework.filters.OrderingFilter',
    ),
    
    # å¼‚å¸¸å¤„ç†
    'EXCEPTION_HANDLER': 'utils.response.custom_exception_handler',
    
    # æ—¥æœŸæ—¶é—´æ ¼å¼
    'DATETIME_FORMAT': '%Y-%m-%d %H:%M:%S',
    'DATE_FORMAT': '%Y-%m-%d',
    'TIME_FORMAT': '%H:%M:%S',
}
```

### 7.2 ç»Ÿä¸€å“åº”æ ¼å¼

```python
# utils/response.py

from rest_framework.response import Response
from rest_framework import status

def success_response(data=None, message='success', code=200):
    """æˆåŠŸå“åº”"""
    return Response({
        'code': code,
        'message': message,
        'data': data
    }, status=status.HTTP_200_OK)

def error_response(message='error', code=400, data=None):
    """é”™è¯¯å“åº”"""
    return Response({
        'code': code,
        'message': message,
        'data': data
    }, status=status.HTTP_200_OK)  # æ³¨æ„ï¼šä¸šåŠ¡é”™è¯¯ä¹Ÿè¿”å›200ï¼Œé€šè¿‡codeåŒºåˆ†

def custom_exception_handler(exc, context):
    """è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨"""
    from rest_framework.views import exception_handler
    
    response = exception_handler(exc, context)
    
    if response is not None:
        custom_response_data = {
            'code': response.status_code,
            'message': str(exc),
            'data': None
        }
        response.data = custom_response_data
    
    return response
```

---

## 8. JWTè®¤è¯é…ç½®

### 8.1 Simple JWT è®¾ç½®

```python
# config/settings.py

from datetime import timedelta

SIMPLE_JWT = {
    'ACCESS_TOKEN_LIFETIME': timedelta(hours=2),      # Access Tokenæœ‰æ•ˆæœŸ2å°æ—¶
    'REFRESH_TOKEN_LIFETIME': timedelta(days=30),    # Refresh Tokenæœ‰æ•ˆæœŸ30å¤©
    'ROTATE_REFRESH_TOKENS': True,                   # åˆ·æ–°æ—¶è½®æ¢Refresh Token
    'BLACKLIST_AFTER_ROTATION': True,                # è½®æ¢ååŠ å…¥é»‘åå•
    'UPDATE_LAST_LOGIN': True,
    
    'ALGORITHM': 'HS256',
    'SIGNING_KEY': SECRET_KEY,
    'VERIFYING_KEY': None,
    'AUDIENCE': None,
    'ISSUER': None,
    
    'AUTH_HEADER_TYPES': ('Bearer',),
    'AUTH_HEADER_NAME': 'HTTP_AUTHORIZATION',
    'USER_ID_FIELD': 'id',
    'USER_ID_CLAIM': 'user_id',
    
    'AUTH_TOKEN_CLASSES': ('rest_framework_simplejwt.tokens.AccessToken',),
    'TOKEN_TYPE_CLAIM': 'token_type',
    
    'JTI_CLAIM': 'jti',
}
```

### 8.2 JWT Token è§†å›¾é…ç½®

```python
# apps/users/urls.py

from django.urls import path
from rest_framework_simplejwt.views import (
    TokenObtainPairView,
    TokenRefreshView,
    TokenVerifyView,
)
from .views import (
    RegisterView,
    LoginView,
    LogoutView,
    UserProfileView,
    UpdateUserProfileView,
    CaptchaView,
)

urlpatterns = [
    # JWT Tokenç›¸å…³
    path('token/', TokenObtainPairView.as_view(), name='token_obtain_pair'),
    path('token/refresh/', TokenRefreshView.as_view(), name='token_refresh'),
    path('token/verify/', TokenVerifyView.as_view(), name='token_verify'),
    
    # è®¤è¯ç›¸å…³
    path('register/', RegisterView.as_view(), name='register'),
    path('login/', LoginView.as_view(), name='login'),
    path('logout/', LogoutView.as_view(), name='logout'),
    path('captcha/', CaptchaView.as_view(), name='captcha'),
    
    # ç”¨æˆ·ä¿¡æ¯
    path('me/', UserProfileView.as_view(), name='user_profile'),
    path('me/update/', UpdateUserProfileView.as_view(), name='update_user_profile'),
]
```

### 8.3 è‡ªå®šä¹‰ç™»å½•è§†å›¾

```python
# apps/users/views.py

from rest_framework import status
from rest_framework.views import APIView
from rest_framework_simplejwt.tokens import RefreshToken
from django.contrib.auth import authenticate
from utils.response import success_response, error_response
from .serializers import UserSerializer
from .utils import verify_captcha

class LoginView(APIView):
    """ç”¨æˆ·ç™»å½•"""
    permission_classes = []  # ç™»å½•æ¥å£ä¸éœ€è¦è®¤è¯
    
    def post(self, request):
        phone = request.data.get('phone')
        password = request.data.get('password')
        captcha_id = request.data.get('captcha_id')
        captcha = request.data.get('captcha')
        
        # éªŒè¯éªŒè¯ç 
        if not verify_captcha(captcha_id, captcha):
            return error_response('éªŒè¯ç é”™è¯¯æˆ–å·²è¿‡æœŸï¼Œè¯·é‡æ–°è·å–', 400)
        
        # éªŒè¯ç”¨æˆ·
        user = authenticate(request, username=phone, password=password)
        if not user:
            return error_response('æ‰‹æœºå·æˆ–å¯†ç é”™è¯¯', 400)
        
        if user.status != 'active':
            return error_response('è´¦æˆ·æœªæ¿€æ´»ï¼Œè¯·è”ç³»ç®¡ç†å‘˜', 403)
        
        # ç”ŸæˆToken
        refresh = RefreshToken.for_user(user)
        
        return success_response({
            'token': str(refresh.access_token),
            'refresh_token': str(refresh),
            'user': UserSerializer(user).data,
            'expires_in': 7200  # 2å°æ—¶
        }, 'ç™»å½•æˆåŠŸ')
```

---

## 9. æ¨¡å‹è®¾è®¡

### 9.1 ç”¨æˆ·æ¨¡å‹

```python
# apps/users/models.py

from django.contrib.auth.models import AbstractBaseUser, BaseUserManager, PermissionsMixin
from django.db import models

class UserManager(BaseUserManager):
    """è‡ªå®šä¹‰ç”¨æˆ·ç®¡ç†å™¨"""
    
    def create_user(self, phone, password=None, **extra_fields):
        if not phone:
            raise ValueError('æ‰‹æœºå·æ˜¯å¿…å¡«é¡¹')
        user = self.model(phone=phone, **extra_fields)
        user.set_password(password)
        user.save(using=self._db)
        return user
    
    def create_superuser(self, phone, password=None, **extra_fields):
        extra_fields.setdefault('role', 'admin')
        extra_fields.setdefault('status', 'active')
        return self.create_user(phone, password, **extra_fields)

class User(AbstractBaseUser, PermissionsMixin):
    """ç”¨æˆ·æ¨¡å‹"""
    ROLE_CHOICES = [
        ('user', 'æ™®é€šç”¨æˆ·'),
        ('doctor', 'åŒ»ç”Ÿ'),
        ('admin', 'ç®¡ç†å‘˜'),
    ]
    STATUS_CHOICES = [
        ('active', 'æ¿€æ´»'),
        ('pending', 'å¾…å®¡æ ¸'),
        ('inactive', 'ç¦ç”¨'),
    ]
    
    phone = models.CharField('æ‰‹æœºå·', max_length=11, unique=True)
    name = models.CharField('å§“å', max_length=50)
    role = models.CharField('è§’è‰²', max_length=10, choices=ROLE_CHOICES, default='user')
    avatar = models.URLField('å¤´åƒ', blank=True, null=True)
    status = models.CharField('çŠ¶æ€', max_length=10, choices=STATUS_CHOICES, default='active')
    created_at = models.DateTimeField('åˆ›å»ºæ—¶é—´', auto_now_add=True)
    updated_at = models.DateTimeField('æ›´æ–°æ—¶é—´', auto_now=True)
    
    objects = UserManager()
    
    USERNAME_FIELD = 'phone'
    REQUIRED_FIELDS = ['name']
    
    class Meta:
        db_table = 'users_user'
        verbose_name = 'ç”¨æˆ·'
        verbose_name_plural = 'ç”¨æˆ·'
    
    def __str__(self):
        return f'{self.name}({self.phone})'
```

### 9.2 åŒ»é™¢æ¨¡å‹

```python
# apps/hospitals/models.py

from django.db import models

class Hospital(models.Model):
    """åŒ»é™¢æ¨¡å‹"""
    name = models.CharField('åŒ»é™¢åç§°', max_length=100)
    address = models.CharField('åœ°å€', max_length=200)
    phone = models.CharField('è”ç³»ç”µè¯', max_length=20)
    latitude = models.FloatField('çº¬åº¦', null=True, blank=True)
    longitude = models.FloatField('ç»åº¦', null=True, blank=True)
    image = models.URLField('å›¾ç‰‡URL', blank=True, null=True)
    rating = models.FloatField('è¯„åˆ†', default=0.0)
    review_count = models.IntegerField('è¯„ä»·æ•°é‡', default=0)
    description = models.TextField('ç®€ä»‹', blank=True)
    business_hours = models.CharField('è¥ä¸šæ—¶é—´', max_length=100, blank=True)
    created_at = models.DateTimeField('åˆ›å»ºæ—¶é—´', auto_now_add=True)
    updated_at = models.DateTimeField('æ›´æ–°æ—¶é—´', auto_now=True)
    
    class Meta:
        db_table = 'hospitals_hospital'
        verbose_name = 'åŒ»é™¢'
        verbose_name_plural = 'åŒ»é™¢'
        ordering = ['-rating', '-review_count']
    
    def __str__(self):
        return self.name
```

### 9.3 åŒ»ç”Ÿæ¨¡å‹

```python
# apps/doctors/models.py

from django.db import models
from apps.users.models import User
from apps.hospitals.models import Hospital

class Doctor(models.Model):
    """åŒ»ç”Ÿæ¨¡å‹"""
    user = models.OneToOneField(User, on_delete=models.CASCADE, related_name='doctor_profile')
    name = models.CharField('å§“å', max_length=50)
    title = models.CharField('èŒç§°', max_length=50)
    specialty = models.CharField('ä¸“ç§‘', max_length=50)
    hospital = models.ForeignKey(Hospital, on_delete=models.CASCADE, related_name='doctors')
    avatar = models.URLField('å¤´åƒ', blank=True, null=True)
    score = models.FloatField('è¯„åˆ†', default=0.0)
    reviews = models.IntegerField('è¯„ä»·æ•°é‡', default=0)
    introduction = models.TextField('ç®€ä»‹', blank=True)
    education = models.CharField('å­¦å†', max_length=100, blank=True)
    experience = models.CharField('ç»éªŒ', max_length=200, blank=True)
    is_online = models.BooleanField('æ˜¯å¦åœ¨çº¿', default=False)
    is_admin = models.BooleanField('æ˜¯å¦ä¸ºç®¡ç†å‘˜', default=False)
    created_at = models.DateTimeField('åˆ›å»ºæ—¶é—´', auto_now_add=True)
    updated_at = models.DateTimeField('æ›´æ–°æ—¶é—´', auto_now=True)
    
    class Meta:
        db_table = 'doctors_doctor'
        verbose_name = 'åŒ»ç”Ÿ'
        verbose_name_plural = 'åŒ»ç”Ÿ'
        ordering = ['-score', '-reviews']
    
    def __str__(self):
        return f'{self.name} - {self.hospital.name}'
```

### 9.4 é¢„çº¦æ¨¡å‹

```python
# apps/appointments/models.py

from django.db import models
from apps.users.models import User
from apps.doctors.models import Doctor
from apps.hospitals.models import Hospital

class Appointment(models.Model):
    """é¢„çº¦æ¨¡å‹"""
    STATUS_CHOICES = [
        ('pending', 'å¾…ç¡®è®¤'),
        ('confirmed', 'å·²ç¡®è®¤'),
        ('cancelled', 'å·²å–æ¶ˆ'),
        ('completed', 'å·²å®Œæˆ'),
        ('no_show', 'æœªåˆ°è¯Š'),
    ]
    
    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='appointments')
    doctor = models.ForeignKey(Doctor, on_delete=models.CASCADE, related_name='appointments')
    hospital = models.ForeignKey(Hospital, on_delete=models.CASCADE, related_name='appointments')
    appointment_date = models.DateField('é¢„çº¦æ—¥æœŸ')
    appointment_time = models.CharField('é¢„çº¦æ—¶é—´', max_length=5)  # HH:mmæ ¼å¼
    symptoms = models.TextField('ç—‡çŠ¶æè¿°', blank=True)
    status = models.CharField('çŠ¶æ€', max_length=20, choices=STATUS_CHOICES, default='pending')
    check_in_time = models.DateTimeField('ç­¾åˆ°æ—¶é—´', null=True, blank=True)
    created_at = models.DateTimeField('åˆ›å»ºæ—¶é—´', auto_now_add=True)
    updated_at = models.DateTimeField('æ›´æ–°æ—¶é—´', auto_now=True)
    
    class Meta:
        db_table = 'appointments_appointment'
        verbose_name = 'é¢„çº¦'
        verbose_name_plural = 'é¢„çº¦'
        ordering = ['-appointment_date', '-appointment_time']
        unique_together = [['doctor', 'appointment_date', 'appointment_time']]  # é˜²æ­¢æ—¶é—´å†²çª
    
    def __str__(self):
        return f'{self.user.name} - {self.doctor.name} - {self.appointment_date}'
```

### 9.5 ç—…å†æ¨¡å‹

```python
# apps/records/models.py

from django.db import models
from apps.users.models import User
from apps.doctors.models import Doctor
from apps.appointments.models import Appointment

class Record(models.Model):
    """ç—…å†æ¨¡å‹"""
    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='records')
    doctor = models.ForeignKey(Doctor, on_delete=models.CASCADE, related_name='records')
    appointment = models.ForeignKey(Appointment, on_delete=models.SET_NULL, null=True, blank=True, related_name='record')
    diagnosis = models.TextField('è¯Šæ–­')
    treatment = models.TextField('æ²»ç–—æ–¹æ¡ˆ', blank=True)
    prescription = models.TextField('å¤„æ–¹', blank=True)
    images = models.JSONField('å›¾ç‰‡åˆ—è¡¨', default=list, blank=True)  # å­˜å‚¨å›¾ç‰‡URLæ•°ç»„
    notes = models.TextField('å¤‡æ³¨', blank=True)
    created_at = models.DateTimeField('åˆ›å»ºæ—¶é—´', auto_now_add=True)
    updated_at = models.DateTimeField('æ›´æ–°æ—¶é—´', auto_now=True)
    
    class Meta:
        db_table = 'records_record'
        verbose_name = 'ç—…å†'
        verbose_name_plural = 'ç—…å†'
        ordering = ['-created_at']
    
    def __str__(self):
        return f'{self.user.name} - {self.diagnosis[:20]}'
```

### 9.6 æ•°æ®åº“è¿ç§»

```bash
# ç”Ÿæˆè¿ç§»æ–‡ä»¶
python manage.py makemigrations

# æ‰§è¡Œè¿ç§»
python manage.py migrate

# åˆ›å»ºè¶…çº§ç®¡ç†å‘˜
python manage.py createsuperuser
```

---

## 10. è§†å›¾å’Œåºåˆ—åŒ–å™¨

### 10.1 ç”¨æˆ·åºåˆ—åŒ–å™¨

```python
# apps/users/serializers.py

from rest_framework import serializers
from .models import User

class UserSerializer(serializers.ModelSerializer):
    """ç”¨æˆ·åºåˆ—åŒ–å™¨"""
    
    class Meta:
        model = User
        fields = ['id', 'name', 'phone', 'role', 'avatar', 'status', 'created_at', 'updated_at']
        read_only_fields = ['id', 'created_at', 'updated_at']

class RegisterSerializer(serializers.ModelSerializer):
    """æ³¨å†Œåºåˆ—åŒ–å™¨"""
    password = serializers.CharField(write_only=True, min_length=6)
    
    class Meta:
        model = User
        fields = ['role', 'name', 'phone', 'password']
    
    def create(self, validated_data):
        role = validated_data.get('role', 'user')
        user = User.objects.create_user(**validated_data)
        
        # æ™®é€šç”¨æˆ·ç›´æ¥æ¿€æ´»ï¼ŒåŒ»ç”Ÿéœ€è¦å®¡æ ¸
        if role == 'doctor':
            user.status = 'pending'
            user.save()
        
        return user
```

### 10.2 åŒ»é™¢è§†å›¾ç¤ºä¾‹

```python
# apps/hospitals/views.py

from rest_framework import viewsets, filters
from rest_framework.permissions import AllowAny
from django_filters.rest_framework import DjangoFilterBackend
from .models import Hospital
from .serializers import HospitalSerializer
from utils.response import success_response

class HospitalViewSet(viewsets.ModelViewSet):
    """åŒ»é™¢è§†å›¾é›†"""
    queryset = Hospital.objects.all()
    serializer_class = HospitalSerializer
    permission_classes = [AllowAny]  # åŒ»é™¢åˆ—è¡¨å…¬å¼€è®¿é—®
    filter_backends = [DjangoFilterBackend, filters.SearchFilter, filters.OrderingFilter]
    filterset_fields = ['name', 'address']
    search_fields = ['name', 'address', 'description']
    ordering_fields = ['rating', 'review_count', 'created_at']
    ordering = ['-rating']
    
    def list(self, request, *args, **kwargs):
        """è·å–åŒ»é™¢åˆ—è¡¨"""
        queryset = self.filter_queryset(self.get_queryset())
        page = self.paginate_queryset(queryset)
        
        if page is not None:
            serializer = self.get_serializer(page, many=True)
            return self.get_paginated_response(serializer.data)
        
        serializer = self.get_serializer(queryset, many=True)
        return success_response(serializer.data)
    
    def retrieve(self, request, *args, **kwargs):
        """è·å–åŒ»é™¢è¯¦æƒ…"""
        instance = self.get_object()
        serializer = self.get_serializer(instance)
        return success_response(serializer.data)
```

---

## 11. URLè·¯ç”±é…ç½®

### 11.1 ä¸»URLé…ç½®

```python
# config/urls.py

from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/auth/', include('apps.users.urls')),
    path('api/hospitals/', include('apps.hospitals.urls')),
    path('api/doctors/', include('apps.doctors.urls')),
    path('api/appointments/', include('apps.appointments.urls')),
    path('api/records/', include('apps.records.urls')),
    path('api/consultations/', include('apps.consultations.urls')),
    path('api/ai/', include('apps.ai_inquiry.urls')),
    path('api/upload/', include('apps.uploads.urls')),
    path('api/statistics/', include('apps.statistics.urls')),
]

# å¼€å‘ç¯å¢ƒï¼šæä¾›åª’ä½“æ–‡ä»¶è®¿é—®
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
    urlpatterns += static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)
```

### 11.2 åº”ç”¨URLé…ç½®ç¤ºä¾‹

```python
# apps/hospitals/urls.py

from django.urls import path, include
from rest_framework.routers import DefaultRouter
from .views import HospitalViewSet

router = DefaultRouter()
router.register(r'', HospitalViewSet, basename='hospital')

urlpatterns = [
    path('', include(router.urls)),
]
```

---

## 12. ä¸­é—´ä»¶å’Œæƒé™

### 12.1 CORSé…ç½®

```python
# config/settings.py

# CORSé…ç½®ï¼ˆå…è®¸å‰ç«¯è·¨åŸŸè®¿é—®ï¼‰
CORS_ALLOWED_ORIGINS = [
    "http://localhost:3000",
    "http://localhost:5173",  # Viteé»˜è®¤ç«¯å£
    "http://127.0.0.1:3000",
    "http://127.0.0.1:5173",
]

CORS_ALLOW_CREDENTIALS = True

CORS_ALLOW_METHODS = [
    'DELETE',
    'GET',
    'OPTIONS',
    'PATCH',
    'POST',
    'PUT',
]

CORS_ALLOW_HEADERS = [
    'accept',
    'accept-encoding',
    'authorization',
    'content-type',
    'dnt',
    'origin',
    'user-agent',
    'x-csrftoken',
    'x-requested-with',
]
```

### 12.2 è‡ªå®šä¹‰æƒé™ç±»

```python
# utils/permissions.py

from rest_framework import permissions

class IsDoctor(permissions.BasePermission):
    """æ£€æŸ¥æ˜¯å¦ä¸ºåŒ»ç”Ÿ"""
    
    def has_permission(self, request, view):
        return request.user and request.user.is_authenticated and request.user.role == 'doctor'

class IsOwnerOrDoctor(permissions.BasePermission):
    """æ£€æŸ¥æ˜¯å¦ä¸ºèµ„æºæ‰€æœ‰è€…æˆ–åŒ»ç”Ÿ"""
    
    def has_object_permission(self, request, view, obj):
        # åŒ»ç”Ÿå¯ä»¥è®¿é—®
        if request.user.role == 'doctor':
            return True
        # èµ„æºæ‰€æœ‰è€…å¯ä»¥è®¿é—®
        if hasattr(obj, 'user'):
            return obj.user == request.user
        return False

class IsAdminDoctor(permissions.BasePermission):
    """æ£€æŸ¥æ˜¯å¦ä¸ºç®¡ç†å‘˜"""
    
    def has_permission(self, request, view):
        if not (request.user and request.user.is_authenticated and request.user.role == 'doctor'):
            return False
        try:
            return request.user.doctor_profile.is_super_doctor
        except:
            return False
```

---

## 13. æ–‡ä»¶ä¸Šä¼ é…ç½®

### 13.1 æ–‡ä»¶ä¸Šä¼ è§†å›¾

```python
# apps/uploads/views.py

from rest_framework.views import APIView
from rest_framework.permissions import IsAuthenticated
from django.core.files.storage import default_storage
from django.core.files.base import ContentFile
from django.conf import settings
import os
import uuid
from datetime import datetime
from utils.response import success_response, error_response
from PIL import Image

class ImageUploadView(APIView):
    """å›¾ç‰‡ä¸Šä¼ è§†å›¾"""
    permission_classes = [IsAuthenticated]
    
    def post(self, request):
        if 'image' not in request.FILES:
            return error_response('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„å›¾ç‰‡', 400)
        
        image_file = request.FILES['image']
        
        # éªŒè¯æ–‡ä»¶ç±»å‹
        allowed_types = ['image/jpeg', 'image/png', 'image/jpg']
        if image_file.content_type not in allowed_types:
            return error_response('åªæ”¯æŒJPGå’ŒPNGæ ¼å¼çš„å›¾ç‰‡', 400)
        
        # éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆæœ€å¤§5MBï¼‰
        if image_file.size > 5 * 1024 * 1024:
            return error_response('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB', 400)
        
        # ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
        file_ext = os.path.splitext(image_file.name)[1]
        timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
        unique_id = str(uuid.uuid4())[:8]
        filename = f'{timestamp}_{request.user.id}_{unique_id}{file_ext}'
        
        # ç¡®å®šå­˜å‚¨è·¯å¾„
        date_path = datetime.now().strftime('%Y/%m/%d')
        file_path = os.path.join('uploads', date_path, filename)
        
        # ä¿å­˜æ–‡ä»¶
        try:
            # æ‰“å¼€å¹¶éªŒè¯å›¾ç‰‡
            img = Image.open(image_file)
            img.verify()
            
            # é‡æ–°æ‰“å¼€ï¼ˆverifyåéœ€è¦é‡æ–°æ‰“å¼€ï¼‰
            img = Image.open(image_file)
            
            # å¯é€‰ï¼šå‹ç¼©å›¾ç‰‡
            if img.size[0] > 1920 or img.size[1] > 1920:
                img.thumbnail((1920, 1920), Image.Resampling.LANCZOS)
            
            # ä¿å­˜
            full_path = os.path.join(settings.MEDIA_ROOT, file_path)
            os.makedirs(os.path.dirname(full_path), exist_ok=True)
            img.save(full_path, format=img.format or 'JPEG', quality=85)
            
            # è¿”å›URL
            file_url = f'{settings.MEDIA_URL}{file_path}'
            return success_response({'url': file_url}, 'ä¸Šä¼ æˆåŠŸ')
            
        except Exception as e:
            return error_response(f'å›¾ç‰‡å¤„ç†å¤±è´¥: {str(e)}', 500)
```

### 13.2 æ–‡ä»¶ä¸Šä¼ URLé…ç½®

```python
# apps/uploads/urls.py

from django.urls import path
from .views import ImageUploadView

urlpatterns = [
    path('image/', ImageUploadView.as_view(), name='image_upload'),
]
```

### 13.3 æ–‡ä»¶å­˜å‚¨è®¾ç½®

```python
# config/settings.py

# åª’ä½“æ–‡ä»¶é…ç½®
MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')

# æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶
FILE_UPLOAD_MAX_MEMORY_SIZE = 5 * 1024 * 1024  # 5MB
DATA_UPLOAD_MAX_MEMORY_SIZE = 5 * 1024 * 1024  # 5MB
```

---

## 14. Nginxé…ç½®

### 14.1 å¼€å‘ç¯å¢ƒNginxé…ç½®ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨Nginxï¼Œå¯ä»¥é…ç½®å¦‚ä¸‹ï¼š

```nginx
# /etc/nginx/sites-available/tooth_system

server {
    listen 80;
    server_name localhost;

    # é™æ€æ–‡ä»¶
    location /static/ {
        alias /path/to/tooth_system_backend/staticfiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    # åª’ä½“æ–‡ä»¶
    location /media/ {
        alias /path/to/tooth_system_backend/media/;
        expires 7d;
        add_header Cache-Control "public";
    }

    # APIè¯·æ±‚è½¬å‘åˆ°Django
    location /api/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocketæ”¯æŒï¼ˆå¦‚æœä½¿ç”¨ï¼‰
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # å‰ç«¯é™æ€æ–‡ä»¶ï¼ˆå¦‚æœå‰åç«¯éƒ¨ç½²åœ¨åŒä¸€æœåŠ¡å™¨ï¼‰
    location / {
        root /path/to/tooth_system_frontend/dist;
        try_files $uri $uri/ /index.html;
    }
}
```

### 14.2 ç”Ÿäº§ç¯å¢ƒNginxé…ç½®

```nginx
# /etc/nginx/sites-available/tooth_system_prod

upstream django {
    server 127.0.0.1:8000;
    # å¯ä»¥é…ç½®å¤šä¸ªåç«¯æœåŠ¡å™¨å®ç°è´Ÿè½½å‡è¡¡
    # server 127.0.0.1:8001;
}

server {
    listen 80;
    server_name yourdomain.com;
    
    # é‡å®šå‘åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com;

    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /path/to/ssl/cert.pem;
    ssl_certificate_key /path/to/ssl/key.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    # å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # é™æ€æ–‡ä»¶
    location /static/ {
        alias /path/to/tooth_system_backend/staticfiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    # åª’ä½“æ–‡ä»¶
    location /media/ {
        alias /path/to/tooth_system_backend/media/;
        expires 7d;
        add_header Cache-Control "public";
        
        # é™åˆ¶ä¸Šä¼ æ–‡ä»¶å¤§å°
        client_max_body_size 10M;
    }

    # APIè¯·æ±‚
    location /api/ {
        proxy_pass http://django;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # å‰ç«¯
    location / {
        root /path/to/tooth_system_frontend/dist;
        try_files $uri $uri/ /index.html;
        
        # ç¼“å­˜æ§åˆ¶
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
}
```

### 14.3 å¯ç”¨Nginxé…ç½®

```bash
# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/tooth_system /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
```

---

## 15. å¼€å‘è§„èŒƒ

### 15.1 ä»£ç è§„èŒƒ

#### 15.1.1 Pythonä»£ç é£æ ¼

- éµå¾ªPEP 8è§„èŒƒ
- ä½¿ç”¨4ä¸ªç©ºæ ¼ç¼©è¿›
- è¡Œé•¿åº¦ä¸è¶…è¿‡100å­—ç¬¦
- ä½¿ç”¨ç±»å‹æç¤ºï¼ˆType Hintsï¼‰

```python
# ç¤ºä¾‹
from typing import List, Optional
from rest_framework.response import Response

def get_hospitals(city: Optional[str] = None) -> List[dict]:
    """è·å–åŒ»é™¢åˆ—è¡¨"""
    pass
```

#### 15.1.2 å‘½åè§„èŒƒ

- **ç±»å**: PascalCaseï¼ˆå¦‚ï¼š`HospitalViewSet`ï¼‰
- **å‡½æ•°/æ–¹æ³•å**: snake_caseï¼ˆå¦‚ï¼š`get_hospital_list`ï¼‰
- **å¸¸é‡**: UPPER_SNAKE_CASEï¼ˆå¦‚ï¼š`MAX_FILE_SIZE`ï¼‰
- **å˜é‡å**: snake_caseï¼ˆå¦‚ï¼š`user_id`ï¼‰

#### 15.1.3 æ³¨é‡Šè§„èŒƒ

```python
class HospitalViewSet(viewsets.ModelViewSet):
    """
    åŒ»é™¢è§†å›¾é›†
    
    æä¾›åŒ»é™¢çš„CRUDæ“ä½œï¼š
    - GET /api/hospitals/ - è·å–åŒ»é™¢åˆ—è¡¨
    - POST /api/hospitals/ - åˆ›å»ºåŒ»é™¢
    - GET /api/hospitals/{id}/ - è·å–åŒ»é™¢è¯¦æƒ…
    - PUT /api/hospitals/{id}/ - æ›´æ–°åŒ»é™¢
    - DELETE /api/hospitals/{id}/ - åˆ é™¤åŒ»é™¢
    """
    
    def list(self, request, *args, **kwargs):
        """
        è·å–åŒ»é™¢åˆ—è¡¨
        
        Args:
            request: HTTPè¯·æ±‚å¯¹è±¡
            *args: ä½ç½®å‚æ•°
            **kwargs: å…³é”®å­—å‚æ•°
            
        Returns:
            Response: åŒ…å«åŒ»é™¢åˆ—è¡¨çš„å“åº”
        """
        pass
```

### 15.2 APIå¼€å‘è§„èŒƒ

#### 15.2.1 ç»Ÿä¸€å“åº”æ ¼å¼

æ‰€æœ‰APIæ¥å£å¿…é¡»ä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼š

```python
# æˆåŠŸå“åº”
{
    "code": 200,
    "message": "success",
    "data": {...}
}

# é”™è¯¯å“åº”
{
    "code": 400,
    "message": "é”™è¯¯ä¿¡æ¯",
    "data": null
}
```

#### 15.2.2 HTTPçŠ¶æ€ç ä½¿ç”¨

- `200`: è¯·æ±‚æˆåŠŸï¼ˆåŒ…æ‹¬ä¸šåŠ¡é”™è¯¯ï¼Œé€šè¿‡codeå­—æ®µåŒºåˆ†ï¼‰
- `400`: è¯·æ±‚å‚æ•°é”™è¯¯
- `401`: æœªæˆæƒï¼ˆTokenæ— æ•ˆæˆ–è¿‡æœŸï¼‰
- `403`: æƒé™ä¸è¶³
- `404`: èµ„æºä¸å­˜åœ¨
- `409`: èµ„æºå†²çª
- `422`: æ•°æ®éªŒè¯å¤±è´¥
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 15.2.3 åˆ†é¡µè§„èŒƒ

åˆ—è¡¨æ¥å£å¿…é¡»æ”¯æŒåˆ†é¡µï¼š

```python
# è¯·æ±‚å‚æ•°
GET /api/hospitals/?page=1&page_size=20

# å“åº”æ ¼å¼
{
    "code": 200,
    "message": "success",
    "data": {
        "count": 100,
        "next": "http://localhost:8000/api/hospitals/?page=2",
        "previous": null,
        "results": [...]
    }
}
```

### 15.3 æ•°æ®åº“æ“ä½œè§„èŒƒ

#### 15.3.1 ä½¿ç”¨äº‹åŠ¡

æ¶‰åŠå¤šè¡¨æ“ä½œæ—¶ï¼Œå¿…é¡»ä½¿ç”¨äº‹åŠ¡ï¼š

```python
from django.db import transaction

@transaction.atomic
def create_appointment(user, doctor, date, time):
    """åˆ›å»ºé¢„çº¦ï¼ˆä½¿ç”¨äº‹åŠ¡ï¼‰"""
    appointment = Appointment.objects.create(...)
    # å…¶ä»–æ•°æ®åº“æ“ä½œ
    return appointment
```

#### 15.3.2 é¿å…N+1æŸ¥è¯¢

ä½¿ç”¨`select_related`å’Œ`prefetch_related`ä¼˜åŒ–æŸ¥è¯¢ï¼š

```python
# é¿å…N+1æŸ¥è¯¢
appointments = Appointment.objects.select_related(
    'user', 'doctor', 'hospital'
).all()

# é¢„åŠ è½½å…³è”æ•°æ®
doctors = Doctor.objects.prefetch_related('appointments').all()
```

### 15.4 é”™è¯¯å¤„ç†è§„èŒƒ

#### 15.4.1 å¼‚å¸¸æ•è·

```python
from rest_framework.exceptions import ValidationError, NotFound
from utils.response import error_response

def get_appointment(pk):
    try:
        appointment = Appointment.objects.get(pk=pk)
        return appointment
    except Appointment.DoesNotExist:
        raise NotFound('é¢„çº¦ä¸å­˜åœ¨')
    except Exception as e:
        logger.error(f'è·å–é¢„çº¦å¤±è´¥: {str(e)}')
        raise ValidationError('è·å–é¢„çº¦å¤±è´¥')
```

#### 15.4.2 æ—¥å¿—è®°å½•

```python
import logging

logger = logging.getLogger(__name__)

def create_record(data):
    try:
        record = Record.objects.create(**data)
        logger.info(f'åˆ›å»ºç—…å†æˆåŠŸ: {record.id}')
        return record
    except Exception as e:
        logger.error(f'åˆ›å»ºç—…å†å¤±è´¥: {str(e)}', exc_info=True)
        raise
```

### 15.5 æµ‹è¯•è§„èŒƒ

#### 15.5.1 å•å…ƒæµ‹è¯•

æ¯ä¸ªåº”ç”¨éƒ½åº”è¯¥æœ‰æµ‹è¯•æ–‡ä»¶ï¼š

```python
# apps/hospitals/tests.py

from django.test import TestCase
from rest_framework.test import APIClient
from .models import Hospital

class HospitalTestCase(TestCase):
    def setUp(self):
        self.client = APIClient()
        self.hospital = Hospital.objects.create(
            name='æµ‹è¯•åŒ»é™¢',
            address='æµ‹è¯•åœ°å€'
        )
    
    def test_list_hospitals(self):
        """æµ‹è¯•è·å–åŒ»é™¢åˆ—è¡¨"""
        response = self.client.get('/api/hospitals/')
        self.assertEqual(response.status_code, 200)
        self.assertEqual(response.data['code'], 200)
```

#### 15.5.2 è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python manage.py test

# è¿è¡Œç‰¹å®šåº”ç”¨çš„æµ‹è¯•
python manage.py test apps.hospitals

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
python manage.py test apps.hospitals.tests.HospitalTestCase
```

---

## 16. éƒ¨ç½²è¯´æ˜

### 16.1 ç”Ÿäº§ç¯å¢ƒå‡†å¤‡

#### 16.1.1 ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»ºç”Ÿäº§ç¯å¢ƒçš„`.env`æ–‡ä»¶ï¼š

```bash
# .env.production

# Djangoé…ç½®
SECRET_KEY=your-production-secret-key-here
DEBUG=False
ALLOWED_HOSTS=yourdomain.com,www.yourdomain.com

# æ•°æ®åº“é…ç½®
DB_NAME=tooth_system_prod
DB_USER=tooth_user
DB_PASSWORD=strong_password_here
DB_HOST=localhost
DB_PORT=3306

# JWTé…ç½®
JWT_SECRET_KEY=your-jwt-secret-key
```

#### 16.1.2 æ”¶é›†é™æ€æ–‡ä»¶

```bash
# æ”¶é›†é™æ€æ–‡ä»¶åˆ°STATIC_ROOT
python manage.py collectstatic --noinput
```

#### 16.1.3 æ•°æ®åº“è¿ç§»

```bash
# æ‰§è¡Œæ•°æ®åº“è¿ç§»
python manage.py migrate

# åˆ›å»ºè¶…çº§ç®¡ç†å‘˜
python manage.py createsuperuser
```

### 16.2 ä½¿ç”¨Gunicornéƒ¨ç½²

#### 16.2.1 å®‰è£…Gunicorn

```bash
pip install gunicorn
```

#### 16.2.2 Gunicorné…ç½®

åˆ›å»º`gunicorn_config.py`ï¼š

```python
# gunicorn_config.py

bind = "127.0.0.1:8000"
workers = 4
worker_class = "sync"
worker_connections = 1000
timeout = 30
keepalive = 2
max_requests = 1000
max_requests_jitter = 50
preload_app = True
```

#### 16.2.3 å¯åŠ¨Gunicorn

```bash
# å¼€å‘ç¯å¢ƒæµ‹è¯•
gunicorn config.wsgi:application --config gunicorn_config.py

# ç”Ÿäº§ç¯å¢ƒï¼ˆåå°è¿è¡Œï¼‰
gunicorn config.wsgi:application \
    --config gunicorn_config.py \
    --daemon \
    --pid /var/run/gunicorn.pid \
    --log-file /var/log/gunicorn.log
```

### 16.3 ä½¿ç”¨Systemdç®¡ç†æœåŠ¡

#### 16.3.1 åˆ›å»ºSystemdæœåŠ¡æ–‡ä»¶

```ini
# /etc/systemd/system/tooth_system.service

[Unit]
Description=Tooth System Django Application
After=network.target

[Service]
Type=notify
User=www-data
Group=www-data
WorkingDirectory=/path/to/tooth_system_backend
Environment="PATH=/path/to/venv/bin"
ExecStart=/path/to/venv/bin/gunicorn config.wsgi:application \
    --config gunicorn_config.py \
    --bind 127.0.0.1:8000
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
```

#### 16.3.2 ç®¡ç†æœåŠ¡

```bash
# å¯åŠ¨æœåŠ¡
sudo systemctl start tooth_system

# åœæ­¢æœåŠ¡
sudo systemctl stop tooth_system

# é‡å¯æœåŠ¡
sudo systemctl restart tooth_system

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status tooth_system

# å¼€æœºè‡ªå¯
sudo systemctl enable tooth_system
```

### 16.4 æ•°æ®åº“å¤‡ä»½

#### 16.4.1 æ‰‹åŠ¨å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -u root -p tooth_system > backup_$(date +%Y%m%d_%H%M%S).sql

# æ¢å¤æ•°æ®åº“
mysql -u root -p tooth_system < backup_20240101_120000.sql
```

#### 16.4.2 è‡ªåŠ¨å¤‡ä»½è„šæœ¬

```bash
#!/bin/bash
# backup_db.sh

BACKUP_DIR="/path/to/backups"
DB_NAME="tooth_system"
DB_USER="root"
DB_PASS="password"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR
mysqldump -u $DB_USER -p$DB_PASS $DB_NAME > $BACKUP_DIR/backup_$DATE.sql

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "backup_*.sql" -mtime +7 -delete
```

### 16.5 ç›‘æ§å’Œæ—¥å¿—

#### 16.5.1 æ—¥å¿—é…ç½®

```python
# config/settings.py

LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'formatters': {
        'verbose': {
            'format': '{levelname} {asctime} {module} {message}',
            'style': '{',
        },
    },
    'handlers': {
        'file': {
            'level': 'INFO',
            'class': 'logging.handlers.RotatingFileHandler',
            'filename': '/var/log/tooth_system/django.log',
            'maxBytes': 1024 * 1024 * 10,  # 10MB
            'backupCount': 5,
            'formatter': 'verbose',
        },
        'console': {
            'level': 'DEBUG',
            'class': 'logging.StreamHandler',
            'formatter': 'verbose',
        },
    },
    'root': {
        'handlers': ['file', 'console'],
        'level': 'INFO',
    },
    'loggers': {
        'django': {
            'handlers': ['file', 'console'],
            'level': 'INFO',
            'propagate': False,
        },
    },
}
```

#### 16.5.2 å¥åº·æ£€æŸ¥æ¥å£

```python
# apps/statistics/views.py

from rest_framework.views import APIView
from rest_framework.permissions import AllowAny
from django.db import connection
from utils.response import success_response, error_response

class HealthCheckView(APIView):
    """å¥åº·æ£€æŸ¥æ¥å£"""
    permission_classes = [AllowAny]
    
    def get(self, request):
        try:
            # æ£€æŸ¥æ•°æ®åº“è¿æ¥
            with connection.cursor() as cursor:
                cursor.execute("SELECT 1")
            
            return success_response({
                'status': 'healthy',
                'database': 'connected'
            })
        except Exception as e:
            return error_response(f'æœåŠ¡å¼‚å¸¸: {str(e)}', 500)
```

---

## 17. å¸¸è§é—®é¢˜è§£å†³

### 17.1 æ•°æ®åº“è¿æ¥é—®é¢˜

**é—®é¢˜**: `django.db.utils.OperationalError: (2003, "Can't connect to MySQL server")`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥MySQLæœåŠ¡æ˜¯å¦å¯åŠ¨
2. æ£€æŸ¥æ•°æ®åº“é…ç½®æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
4. ç¡®è®¤æ•°æ®åº“ç”¨æˆ·æƒé™

### 17.2 CORSè·¨åŸŸé—®é¢˜

**é—®é¢˜**: å‰ç«¯è¯·æ±‚æ—¶å‡ºç°CORSé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥`CORS_ALLOWED_ORIGINS`é…ç½®
2. ç¡®è®¤å‰ç«¯åœ°å€åœ¨å…è®¸åˆ—è¡¨ä¸­
3. æ£€æŸ¥`CORS_ALLOW_CREDENTIALS`è®¾ç½®

### 17.3 JWT Tokenè¿‡æœŸé—®é¢˜

**é—®é¢˜**: Tokené¢‘ç¹è¿‡æœŸ

**è§£å†³æ–¹æ¡ˆ**:
1. è°ƒæ•´`ACCESS_TOKEN_LIFETIME`è®¾ç½®
2. å®ç°Tokenè‡ªåŠ¨åˆ·æ–°æœºåˆ¶
3. æ£€æŸ¥ç³»ç»Ÿæ—¶é—´æ˜¯å¦å‡†ç¡®

### 17.4 æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶

**é—®é¢˜**: ä¸Šä¼ å¤§æ–‡ä»¶å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. è°ƒæ•´Djangoçš„`FILE_UPLOAD_MAX_MEMORY_SIZE`
2. è°ƒæ•´Nginxçš„`client_max_body_size`
3. è€ƒè™‘ä½¿ç”¨å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼ˆOSSï¼‰

### 17.5 æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ•°æ®åº“ç´¢å¼•**: ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
2. **æŸ¥è¯¢ä¼˜åŒ–**: ä½¿ç”¨`select_related`å’Œ`prefetch_related`
3. **ç¼“å­˜**: å¯¹çƒ­ç‚¹æ•°æ®ä½¿ç”¨Redisç¼“å­˜
4. **åˆ†é¡µ**: æ‰€æœ‰åˆ—è¡¨æ¥å£å¿…é¡»åˆ†é¡µ
5. **å¼‚æ­¥ä»»åŠ¡**: è€—æ—¶æ“ä½œä½¿ç”¨Celeryå¼‚æ­¥å¤„ç†

---

## 18. å¼€å‘æ£€æŸ¥æ¸…å•

### 18.1 é¡¹ç›®åˆå§‹åŒ–æ£€æŸ¥

- [ ] Pythonè™šæ‹Ÿç¯å¢ƒå·²åˆ›å»º
- [ ] ä¾èµ–åŒ…å·²å®‰è£…ï¼ˆrequirements.txtï¼‰
- [ ] MySQLæ•°æ®åº“å·²åˆ›å»º
- [ ] .envæ–‡ä»¶å·²é…ç½®
- [ ] Djangoé¡¹ç›®å·²åˆå§‹åŒ–
- [ ] æ‰€æœ‰åº”ç”¨å·²åˆ›å»º
- [ ] æ•°æ®åº“è¿ç§»å·²æ‰§è¡Œ

### 18.2 åŠŸèƒ½å¼€å‘æ£€æŸ¥

- [ ] æ¨¡å‹å·²å®šä¹‰å¹¶è¿ç§»
- [ ] åºåˆ—åŒ–å™¨å·²å®ç°
- [ ] è§†å›¾å·²å®ç°
- [ ] URLè·¯ç”±å·²é…ç½®
- [ ] æƒé™æ§åˆ¶å·²å®ç°
- [ ] ç»Ÿä¸€å“åº”æ ¼å¼å·²ä½¿ç”¨
- [ ] é”™è¯¯å¤„ç†å·²å®Œå–„
- [ ] æ—¥å¿—è®°å½•å·²æ·»åŠ 

### 18.3 æµ‹è¯•æ£€æŸ¥

- [ ] å•å…ƒæµ‹è¯•å·²ç¼–å†™
- [ ] æ¥å£æµ‹è¯•å·²é€šè¿‡
- [ ] æƒé™æµ‹è¯•å·²é€šè¿‡
- [ ] è¾¹ç•Œæƒ…å†µå·²æµ‹è¯•

### 18.4 éƒ¨ç½²å‰æ£€æŸ¥

- [ ] DEBUGå·²è®¾ç½®ä¸ºFalse
- [ ] SECRET_KEYå·²æ›´æ¢
- [ ] ALLOWED_HOSTSå·²é…ç½®
- [ ] é™æ€æ–‡ä»¶å·²æ”¶é›†
- [ ] æ•°æ®åº“è¿ç§»å·²æ‰§è¡Œ
- [ ] æ—¥å¿—é…ç½®å·²å®Œå–„
- [ ] Nginxé…ç½®å·²æµ‹è¯•
- [ ] Gunicorné…ç½®å·²ä¼˜åŒ–

---

## 19. å‚è€ƒèµ„æº

### 19.1 å®˜æ–¹æ–‡æ¡£

- [Djangoå®˜æ–¹æ–‡æ¡£](https://docs.djangoproject.com/)
- [Django REST Frameworkæ–‡æ¡£](https://www.django-rest-framework.org/)
- [Simple JWTæ–‡æ¡£](https://django-rest-framework-simplejwt.readthedocs.io/)
- [MySQLå®˜æ–¹æ–‡æ¡£](https://dev.mysql.com/doc/)
- [Nginxå®˜æ–¹æ–‡æ¡£](https://nginx.org/en/docs/)

### 19.2 ç›¸å…³å·¥å…·

- [Postman](https://www.postman.com/) - APIæµ‹è¯•å·¥å…·
- [Django Debug Toolbar](https://django-debug-toolbar.readthedocs.io/) - è°ƒè¯•å·¥å…·
- [Django Extensions](https://django-extensions.readthedocs.io/) - æ‰©å±•å·¥å…·é›†

### 19.3 å­¦ä¹ èµ„æº

- [Djangoæœ€ä½³å®è·µ](https://docs.djangoproject.com/en/stable/misc/design-philosophies/)
- [RESTful APIè®¾è®¡æŒ‡å—](https://restfulapi.net/)
- [JWTè®¤è¯æœ€ä½³å®è·µ](https://jwt.io/introduction)

---

## 20. æ€»ç»“

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†åŸºäºDjangoã€DRFã€Nginxã€JWTã€MySQLæŠ€æœ¯æ ˆçš„ç‰™ç§‘é¢„çº¦ç®¡ç†ç³»ç»Ÿåç«¯æ­å»ºæµç¨‹ã€‚æŒ‰ç…§æœ¬æ–‡æ¡£çš„æ­¥éª¤ï¼Œå¯ä»¥å¿«é€Ÿæ­å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ç»“æ„æ¸…æ™°çš„åç«¯ç³»ç»Ÿã€‚

### å…³é”®è¦ç‚¹

1. **é¡¹ç›®ç»“æ„**: é‡‡ç”¨Djangoåº”ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹
2. **è®¤è¯æœºåˆ¶**: ä½¿ç”¨JWT Tokenå®ç°æ— çŠ¶æ€è®¤è¯
3. **APIè®¾è®¡**: éµå¾ªRESTfulè§„èŒƒï¼Œç»Ÿä¸€å“åº”æ ¼å¼
4. **æƒé™æ§åˆ¶**: åŸºäºè§’è‰²çš„æƒé™ç®¡ç†ï¼ˆç”¨æˆ·/åŒ»ç”Ÿ/ç®¡ç†å‘˜ï¼‰
5. **æ–‡ä»¶ç®¡ç†**: æ”¯æŒå›¾ç‰‡ä¸Šä¼ ï¼Œè‡ªåŠ¨ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
6. **éƒ¨ç½²æ–¹æ¡ˆ**: ä½¿ç”¨Gunicorn + Nginxå®ç°ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### åç»­ä¼˜åŒ–æ–¹å‘

1. **ç¼“å­˜ä¼˜åŒ–**: å¼•å…¥Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
2. **å¼‚æ­¥ä»»åŠ¡**: ä½¿ç”¨Celeryå¤„ç†è€—æ—¶æ“ä½œ
3. **å®æ—¶é€šä¿¡**: ä½¿ç”¨WebSocketå®ç°å®æ—¶èŠå¤©
4. **AIé›†æˆ**: æ¥å…¥AIæœåŠ¡å®ç°æ™ºèƒ½é—®è¯¢
5. **ç›‘æ§å‘Šè­¦**: é›†æˆç›‘æ§ç³»ç»Ÿï¼Œå®æ—¶ç›‘æ§æœåŠ¡çŠ¶æ€

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024å¹´1æœˆ  
**ç»´æŠ¤è€…**: åç«¯å¼€å‘å›¢é˜Ÿ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚