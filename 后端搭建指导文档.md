# 牙科预约管理系统 - 后端搭建指导文档

> 📚 本文档面向新手开发者，提供详细的后端环境搭建步骤，让您能够快速启动项目。

## 1. 环境要求

在开始之前，请确保您的电脑已安装以下软件：

### 必需软件

- **Python 3.10+** 

- **MySQL 8.0+**

- **Git**（用于版本控制）


### 推荐工具

- **PyCharm** （代码编辑器）
- **Navicat** （数据库管理工具）

---

## 2. 准备工作

### 2.1 创建 MySQL 数据库
   
   创建名为 tooth_system 的数据库
   可直接在Navicat中创建


### 2.2 获取项目代码

如果您使用 Git：
```bash
git clone https://github.com/Tsyq/tooth_system_xm
```


## 3. 安装步骤

### 3.1 创建 Python 虚拟环境


**Windows 系统：**
```bash
# 在项目根目录下执行
python -m venv venv

# 激活虚拟环境
venv\Scripts\activate
```

**验证虚拟环境激活成功：**
激活后，命令行前面会显示 `(venv)` 标识。

### 3.2 安装 Python 依赖包

在虚拟环境激活的状态下，执行：

```bash

# 安装项目依赖
pip install -r requirements.txt
```

**验证安装成功：**
```bash
pip list
```
应该能看到所有依赖包，包括 Django、djangorestframework 等。

### 3.3 配置环境变量

1. **创建 .env 文件：**

2. **编辑 .env 文件：**
   使用文本编辑器打开 `.env` 文件，根据实际情况修改以下配置：

   ```env
   # Django 密钥（生产环境必须修改！）
   SECRET_KEY=django-insecure-8^9bnj&3)2an&iqs^lt*up-1^c+qhpknmjiwlt@m9$^i-a=sl!
   
   # 调试模式
   DEBUG=True
   
   # 允许的主机
   ALLOWED_HOSTS=localhost,127.0.0.1
   
   # 数据库配置
   DB_NAME=tooth_system
   DB_USER=root
   DB_PASSWORD=你的MySQL密码
   DB_HOST=localhost
   DB_PORT=3306
   
   # CORS 跨域配置（前端地址）
   CORS_ALLOWED_ORIGINS=http://localhost:3000
   ```

   **重要提示：**
   - `SECRET_KEY` 在生产环境必须修改（可以使用 Django 命令生成：`python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"`）

---

## 4. 配置说明

### 4.1 数据库配置

项目使用 MySQL 数据库，配置信息在 `.env` 文件中：

### 4.2 CORS 跨域配置

前端运行在 `http://localhost:3000`，已在 `.env` 文件中配置：

```env
CORS_ALLOWED_ORIGINS=http://localhost:3000
```

### 4.3 其他配置

- `DEBUG`: 开发环境设为 `True`，生产环境必须设为 `False`
- `ALLOWED_HOSTS`: 允许访问的主机地址，多个用逗号分隔

---

## 5. 启动项目

### 5.1 运行数据库迁移

**什么是数据库迁移？**
数据库迁移是将 Django 模型（models）转换为数据库表结构的过程。

```bash
# 生成迁移文件
python manage.py makemigrations

# 执行迁移（创建数据库表）
python manage.py migrate
```

**如果出现错误：**
- 检查 `.env` 文件中的数据库配置是否正确,需创建
- 确认 MySQL 服务已启动
- 确认数据库 `tooth_system` 已创建

### 5.2 创建超级管理员 (可忽略)

```bash
python manage.py createsuperuser
```

按提示输入：
- 手机号（作为用户名）
- 姓名
- 密码（输入时不会显示，直接输入即可）
- 确认密码

**示例：**
```
手机号: 13800138000
姓名: admin
密码: ********
确认密码: ********
```

### 5.3 启动开发服务器

```bash
python manage.py runserver
```

**成功启动后，您会看到：**
```
Starting development server at http://127.0.0.1:8000/
Quit the server with CTRL-BREAK.
```

### 5.4 访问项目

- **Django 管理后台：** http://127.0.0.1:8000/admin/
  - 使用刚才创建的超级管理员账号登录

- **API 接口文档：** http://127.0.0.1:8000/api/
  - 查看所有可用的 API 接口

---

## 6. 查看项目结构

```
TOOTH_SYSTEM_XM/
├── manage.py                 # Django 管理脚本
├── requirements.txt         # 依赖包列表
├── .env                     # 环境变量配置（不提交到Git）
├── .env.example             # 环境变量示例文件
├── tooth_system/            # 项目主配置目录
│   ├── settings.py         # 项目设置
│   ├── urls.py             # 主URL配置
│   └── wsgi.py             # WSGI配置
├── user/                    # 用户认证应用
├── hospitals/               # 医院管理应用
├── doctors/                 # 医生管理应用
├── appointments/            # 预约管理应用
├── records/                 # 病历管理应用
├── consultations/           # 在线问诊应用
├── ai_inquiry/             # AI问询应用
├── uploads/                 # 文件上传应用
├── statistics/              # 统计数据应用
└── utils/                   # 工具模块
```
---

## ✅ 检查清单

在开始开发前，请确认：

- [ ] Python 3.10+ 已安装
- [ ] MySQL 8.0+ 已安装并运行
- [ ] 虚拟环境已创建并激活
- [ ] 所有依赖包已安装
- [ ] `.env` 文件已配置
- [ ] 数据库已创建
- [ ] 数据库迁移已执行
- [ ] 超级管理员已创建
- [ ] 开发服务器已启动
- [ ] 可以访问管理后台

---

下附系统主要的数据库表
user	用户表
hospital	医院表
doctor	医生表
appointment	预约表
record	病历表
consultation	问诊会话表
consultation_message	问诊消息表
ai_inquiry	AI问询表
comment	评论表